Tool: gmail
Package: @kazibee/gmail

Use this tool for Gmail operations. Prefer precise calls with explicit limits and query filters.
Use message IDs internally for follow-up actions, but keep user-facing output human-friendly by default.
Default to user-friendly summary outputs unless the user explicitly asks for IDs-only behavior.

Auth requirements
- CLIENT_ID
- CLIENT_SECRET
- REFRESH_TOKEN
- If auth fails, instruct user to run: kazibee gmail login
- For Drive-file attachments, login must include Drive readonly scope.

Typical intents to map
- "latest emails" -> listMessageSummaries(...) with maxResults and optional query
- "get my emails" -> listMessageSummaries(...) with sensible maxResults (default 20)
- "read this email" -> get message by ID
- "send email" -> send message with to/subject/body
- "send with local attachments" -> sendMessageWithAttachments(...)
- "send with Google Drive file IDs" -> sendMessageWithDriveAttachments(...)
- "save draft" -> createDraft or attachment-aware draft methods
- "download attachment" -> listAttachments + downloadAttachment/downloadAttachmentPart
- "labels" -> list labels, add/remove labels
- "filters" -> list/create/delete filters

Method selection policy
- For generic list intents, use listMessageSummaries(query?, maxResults?).
- Use listMessages(query?, maxResults?) only when user explicitly asks for IDs-only output or fastest reference listing.
- Use getMessage(messageId) when the user asks to read, summarize, or inspect one specific message.

Tool-use flow
- Step 1: Resolve intent as list, single-message read, send/reply, draft, labels, filters, or attachments.
- Step 2: Choose the narrowest method that satisfies the request.
- Step 3: Format output for readability first; expose IDs only when requested or necessary for next actions.

Defaults and limits
- If user gives no count, use maxResults = 20.
- If user asks for "all emails", ask for a limit or use a safe cap (for example 50) and say results are limited.
- Preserve user-provided filters exactly when possible (from:, subject:, is:unread, in:inbox, newer_than:, etc).
- For date-relative requests ("last 7 days"), prefer query syntax like newer_than:7d.

Examples
- "List my 20 latest unread emails from the inbox."
- "Find emails from billing@company.com in the last 7 days."
- "Get message 18c7f0... and summarize it."
- "Send this with files attached from /tmp."
- "Send this with Drive files 1abc.. and 1def.. attached."
- "Download all attachments from message 18c7f0..."

Code call examples
```ts
const summaries = await tools["gmail"].listMessageSummaries("is:unread in:inbox", 20);
const refs = await tools["gmail"].listMessages("is:unread in:inbox", 20); // IDs-only fast path
const msg = await tools["gmail"].getMessage("18c7f0abc123");

const sent = await tools["gmail"].sendMessage(
  "alice@example.com",
  "Project Update",
  "Quick status: on track for Friday."
);

const sentWithLocalFiles = await tools["gmail"].sendMessageWithAttachments(
  "ops@example.com",
  "Weekly Report",
  "See attachments.",
  [
    { path: "/tmp/report.pdf" },
    { path: "/tmp/export.csv", filename: "metrics.csv", mimeType: "text/csv" }
  ]
);

const sentWithDriveFiles = await tools["gmail"].sendMessageWithDriveAttachments(
  "ops@example.com",
  "Drive Attachments",
  "Attached directly from Drive.",
  [
    { fileId: "1abcDriveFileId" },
    { fileId: "1defDriveFileId", filename: "renamed.pdf" }
  ]
);

const draftWithDrive = await tools["gmail"].createDraftWithDriveAttachments(
  "ops@example.com",
  "Draft With Drive Files",
  "Please review.",
  [{ fileId: "1abcDriveFileId" }]
);

const attachmentParts = await tools["gmail"].listAttachments("18c7f0abc123");
await tools["gmail"].downloadAttachmentPart(
  "18c7f0abc123",
  attachmentParts[0].partId,
  "/tmp/attachment.bin"
);

const filters = await tools["gmail"].listFilters();
const createdFilter = await tools["gmail"].createFilter(
  { from: "billing@company.com", hasAttachment: true },
  { addLabelIds: ["IMPORTANT"], removeLabelIds: ["INBOX"] }
);
await tools["gmail"].deleteFilter(createdFilter.id);
```

Output behavior
- Return concise structured results.
- For generic list intents (e.g. "get my emails"), default to `listMessageSummaries`.
- Use `listMessages` only when the user explicitly wants IDs-only or a faster reference-only listing.
- Do not show internal message IDs in user-facing output by default.
- Show message IDs only when user asks for IDs explicitly or when an immediate follow-up action requires selecting a specific message.
- For list outputs, prefer a clean numbered view (from, subject, date, snippet) without IDs.
- Summary list payload fields available: id, threadId, from, subject, date, snippet.
- For "read/summarize this email" requests, return the message content summary, not raw metadata dumps.
- On write actions, confirm success with the returned ID/state.
- For attachment operations, include filenames/IDs and output paths.
- On auth errors, tell user to run: `kazibee gmail login`.
